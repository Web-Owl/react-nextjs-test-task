(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{6760:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(8833)}])},8833:(e,t,a)=>{"use strict";a.r(t),a.d(t,{__N_SSG:()=>_,default:()=>D});var n=a(7876),r=a(4232),l=a(2227),s=a(6768),i=a(1040);let c="/api/proxy";async function d(){return(await i.A.get("".concat(c,"/reviews"))).data}async function o(e,t){return(await i.A.get("".concat(c,"/products"),{params:{page:e,page_size:t}})).data}async function u(e){return(await i.A.post("".concat(c,"/order"),e,{headers:{"content-type":"application/json"}})).data}function x(e){let{initialReviews:t}=e,{reviews:a,isLoading:i,isError:c}=function(){let{data:e,error:t}=(0,s.Ay)("reviews",d,{revalidateOnFocus:!1});return{reviews:e,isLoading:!t&&!e,isError:t}}(),[o,u]=(0,r.useState)(t);return((0,r.useEffect)(()=>{a&&a.length>0&&u(a)},[a]),i)?(0,n.jsx)("p",{className:"text-center py-4",children:"Загрузка отзывов..."}):c?(0,n.jsx)("p",{className:"text-center py-4 text-red-600",children:"Ошибка загрузки отзывов"}):(0,n.jsxs)("section",{className:"my-8",children:[o&&0===o.length&&(0,n.jsx)("p",{children:"Отзывов пока нет."}),(0,n.jsx)("ul",{className:"flex flex-col flex-wrap justify-center md:grid md:grid-cols-2 gap-5 md:gap-8 md:flex-row",children:null==o?void 0:o.map(e=>{let{id:t,text:a}=e;return(0,n.jsx)("li",{className:"py-7 px-5 rounded-2xl dark:text-black dark:bg-[#D9D9D9]",dangerouslySetInnerHTML:{__html:"<h2>Отзыв ".concat(t,"</h2> ").concat(l.A.sanitize(a))}},t)})})]})}var m=a(5065),p=a(2165),f=a(4587),h=a.n(f);function g(e){let{product:t}=e,a=(0,m.j)(),l=(0,m.G)(e=>e.cart.cart.find(e=>e.id===t.id)),s=l?l.quantity:0,[i,c]=(0,r.useState)(!1);(0,r.useEffect)(()=>{c(!0)},[]);let[d,o]=(0,r.useState)(s.toString());return((0,r.useEffect)(()=>{o(s.toString())},[s]),i)?(0,n.jsxs)("div",{className:"flex flex-col md:w-xs gap-4 border border-gray-300 rounded-lg p-2.5 dark:text-black items-center dark:bg-[#D9D9D9]",children:[(0,n.jsx)(h(),{src:t.image_url,alt:t.title,width:281,height:366,className:"object-contain rounded-xl"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("h3",{title:t.title,className:"text-lg font-medium truncate text-center",children:t.title.length>50?t.title.slice(0,50)+"...":t.title}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:t.description}),(0,n.jsxs)("p",{className:"mt-2 text-2xl text-center",children:["цена: ",t.price.toLocaleString("ru-RU")," ₽"]})]}),(0,n.jsx)("div",{className:"min-w-[120px] text-center self-stretch",children:0===s?(0,n.jsx)("button",{onClick:()=>a((0,p.B5)(t.id)),className:"dark:text-white dark:bg-[#222222] rounded-xl px-4 py-2 transition w-full cursor-pointer",children:"Купить"}):(0,n.jsxs)("div",{className:"flex gap-2 ",children:[(0,n.jsx)("button",{onClick:()=>a((0,p.Ai)(t.id)),"aria-label":"Уменьшить количество",className:"dark:text-white dark:bg-[#222222] rounded-xl transition cursor-pointer basis-10 px-4 py-2",children:"-"}),(0,n.jsx)("input",{type:"text",inputMode:"numeric",value:d,onChange:function(e){let n=e.target.value;if(/^\d*$/.test(n)){o(n);let e=parseInt(n,10);isNaN(e)?a((0,p.Rq)({id:t.id,quantity:0})):a((0,p.Rq)({id:t.id,quantity:e}))}},"aria-label":"Количество товара",maxLength:5,className:"w-12 text-center dark:text-white dark:bg-[#222222] rounded-xl grow px-4 py-2"}),(0,n.jsx)("button",{onClick:()=>a((0,p.B5)(t.id)),"aria-label":"Увеличить количество",className:"dark:text-white dark:bg-[#222222] rounded-xl transition cursor-pointer basis-10 px-4 py-2",children:"+"})]})})]}):(0,n.jsx)("button",{className:"dark:text-[#D9D9D9] dark:bg-black px-4 py-2 rounded cursor-not-allowed opacity-50",disabled:!0,children:"Загрузка..."})}let y="cart",j="phone";function b(e){let{initialProducts:t}=e,{products:a,loading:l,error:s,loadMore:i,hasMore:c}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,[t,a]=(0,r.useState)([]),[n,l]=(0,r.useState)(1),[s,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),[u,x]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{!async function(){i(!0),d(null);try{let r=await o(n,e);a(e=>[...e,...r.items]),x(()=>t.length+r.items.length<r.total)}catch(e){d(e)}finally{i(!1)}}()},[n,e,t]),{products:t,loading:s,error:c,loadMore:function(){!s&&u&&l(e=>e+1)},hasMore:u}}(20),{cart:d,addItem:u,removeItem:x,setItemQuantity:m}=function(){let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)("");return(0,r.useEffect)(()=>{let e=localStorage.getItem(y);e&&t(JSON.parse(e));let a=localStorage.getItem(j);a&&n(a)},[]),(0,r.useEffect)(()=>{localStorage.setItem(y,JSON.stringify(e))},[e]),(0,r.useEffect)(()=>{localStorage.setItem(j,a)},[a]),{cart:e,addItem:function(e){console.log(e),t(t=>t.find(t=>t.id===e)?t.map(t=>t.id===e?{...t,quantity:t.quantity+1}:t):[...t,{id:e,quantity:1}])},removeItem:function(e){t(t=>t.map(t=>t.id===e?{...t,quantity:t.quantity-1}:t).filter(e=>e.quantity>0))},setItemQuantity:function(e,a){a<=0?t(t=>t.filter(t=>t.id!==e)):t(t=>t.find(t=>t.id===e)?t.map(t=>t.id===e?{...t,quantity:a}:t):[...t,{id:e,quantity:a}])},clearCart:function(){t([])},phone:a,setPhone:n}}(),[p,f]=(0,r.useState)(t);(0,r.useEffect)(()=>{a&&a.length>0&&f(a)},[a]);let h=(0,r.useRef)(null),b=(0,r.useCallback)(e=>{!l&&(h.current&&h.current.disconnect(),h.current=new IntersectionObserver(e=>{e[0].isIntersecting&&c&&i()}),e&&h.current.observe(e))},[l,c,i]);return s?(0,n.jsx)("p",{className:"text-center text-red-600 py-4",children:"Ошибка загрузки товаров"}):(0,n.jsx)("section",{className:"my-8",children:(0,n.jsxs)("div",{className:"flex flex-wrap flex-col justify-center gap-4 md:flex-row md:gap-8",children:[p.map((e,t)=>{let a=d.find(t=>t.id===e.id),r=a?a.quantity:0;return t===p.length-1?(0,n.jsx)("div",{ref:b,children:(0,n.jsx)(g,{product:e,quantity:r,onAdd:()=>u(e.id),onRemove:()=>x(e.id),onSetQuantity:t=>m(e.id,t)})},e.id):(0,n.jsx)(g,{product:e,quantity:r,onAdd:()=>u(e.id),onRemove:()=>x(e.id),onSetQuantity:t=>m(e.id,t)},e.id)}),l&&(0,n.jsx)("p",{className:"text-center py-4",children:"Загрузка..."})]})})}var w=a(4889),N=a.n(w);let k=r.forwardRef((e,t)=>{let{value:a,onChange:r,error:l}=e;return(0,n.jsx)(N(),{mask:"+7 (999) 999-99-99",value:a,onChange:e=>r(e.target.value),placeholder:"+7 (___) ___-__-__",id:"phone",className:"py-3 px-4 border rounded-2xl outline-none dark:bg-[#222222] dark:text-white ".concat(l?"border-red-600":"border-gray-300","  transition"),ref:t})});function v(e){let{visible:t,onClose:a}=e;return t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:a,"aria-hidden":"true"}),(0,n.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg p-8 shadow-lg z-50 max-w-sm w-full text-center",role:"dialog","aria-modal":"true",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Заказ успешно оформлен!"}),(0,n.jsx)("button",{onClick:a,"aria-label":"Закрыть",className:"dark:text-[#D9D9D9] dark:bg-black px-6 py-2 rounded transition cursor-pointer",children:"Закрыть"})]})]}):null}function S(e){let{products:t}=e,a=(0,m.j)(),l=(0,m.G)(e=>e.cart.cart),s=l.map(e=>{let{id:a,quantity:n}=e,r=t.find(e=>e.id===a);return r?{...r,quantity:n}:null}).filter(Boolean),i=(0,m.G)(e=>e.cart.phone),[c,d]=(0,r.useState)(!1),[o,x]=(0,r.useState)(!1),[f,h]=(0,r.useState)(!1),[g,y]=(0,r.useState)(!1),[j,b]=(0,r.useState)(null);async function w(){if(b(null),11!==i.replace(/\D/g,"").length)return void x(!0);if(0===l.length)return void b("Корзина пуста");x(!1),h(!0);try{let e=await u({phone:i.replace(/\D/g,""),cart:l});1===e.success?(y(!0),a((0,p.sX)())):b(e.error||"Ошибка при оформлении заказа")}catch(e){b("Ошибка сети")}finally{h(!1)}}return((0,r.useEffect)(()=>{d(!0)},[]),c)?(0,n.jsxs)("section",{className:"rounded-2xl py-2.5 px-3 max-w-md mx-auto my-8 dark:text-black dark:bg-[#D9D9D9]",children:[(0,n.jsx)("p",{className:"font-normal text-4xl mb-4 ",children:"Добавленные товары"}),0===s.length?(0,n.jsx)("p",{children:"Корзина пуста"}):(0,n.jsx)("ul",{children:s.map(e=>{let{id:t,title:a,price:r,quantity:l}=e;return(0,n.jsxs)("li",{className:"flex justify-between py-1",children:[(0,n.jsxs)("span",{children:[a," x",l]}),(0,n.jsxs)("span",{children:[(r*l).toLocaleString("ru-RU")," ₽"]})]},t)})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 md:gap-4 md:flex-row",children:[(0,n.jsx)(k,{value:i,onChange:e=>a((0,p.nP)(e)),error:o}),j&&(0,n.jsx)("p",{className:"text-red-600 mb-4",children:j}),(0,n.jsx)("button",{onClick:w,disabled:f,className:"w-full py-3 text-white font-normal transition rounded-2xl cursor-pointer ".concat(f?"cursor-not-allowed":"dark:bg-[#222222]"),children:f?"Отправка...":"Заказать"})]}),(0,n.jsx)(v,{visible:g,onClose:()=>y(!1)})]}):null}k.displayName="PhoneInput";var _=!0;let D=e=>{let{initialReviews:t,initialProducts:a}=e;return(0,n.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,n.jsx)("h1",{className:"text-3xl md:text-8xl text-center mb-8 dark:bg-[#777777] p-4 rounded-2xl font-normal",children:"тестовое задание"}),(0,n.jsx)(x,{initialReviews:t}),(0,n.jsx)(S,{products:a.items}),(0,n.jsx)(b,{initialProducts:a.items})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[319,636,593,792],()=>t(6760)),_N_E=e.O()}]);